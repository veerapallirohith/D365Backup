https://d365fotechnicalblog.blogspot.com/2023/03/create-table-in-email-body-using-x-code.html


 /// <summary>
    /// Thsi method is used to send mail to user for notifying the approval
    /// </summary>
    public void EmailApproval(MultiSelectionHelper    multiselectionhelper)
    {
        SysMailerMessageBuilder  messageBuilder = new SysMailerMessageBuilder();
        SysInfoLogStr            emailBodyWithHtml;
        SysEmailParameters       sysEmailParameters = SysEmailParameters::find();
        EmailBase                fromEmail = sysEmailParameters.SMTPUserName;
        ProjTable                projTable;
        MapEnumerator            enumerator;
        DGMA_PaymentApplicationApproverTmp TmpTable;
        boolean                 emailSend;
        str                     mail ;
        DGMA_PaymentTable       paymentTable = multiselectionhelper.getFirst();
        Map AddressMap = new Map(Types::String,Types::String);
        #define.body("<table border = '1'><tr><td><b>project id<b></td><td><b>Service order<b></td></tr>")
        #define.trtd('<tr><td>')
        #define.tdtd('</td><td>')
        #define.tdtr('</td></tr>')
        #define.table('</Table>')
        if(!fromEmail)
        {
            throw Global::error("@DGMA_Label:ApprovalSmtpFromUserIdDoesntExist");
        }
        try
        {
            while(paymentTable)
            {
                projTable = projTable::find(paymentTable.Project);
                TmpTable.Project =  projTable.projid;
                TmpTable.ServiceOrder = paymentTable.ServiceOrderId;
                TmpTable.Email  = projTable.ApprovalEmail;
                TmpTable.insert();
                AddressMap.insert(projTable.ApprovalEmail,emailBodyWithHtml);
                paymentTable = multiselectionhelper.getNext();
            }
           
            enumerator = AddressMap.getEnumerator();
           
            while( enumerator.moveNext())
            {
                emailBodyWithHtml =  "@DGMA_Label:ApprovalEmailBody" + #body;

                while select TmpTable where TmpTable.Email == enumerator.currentKey()
                {
                    emailBodyWithHtml += #trtd+TmpTable.Project+#tdtd+TmpTable.ServiceOrder+#tdtr;
                    mail = enumerator.currentKey();
                }
                emailBodyWithHtml += #table;
                messageBuilder.reset();
                messageBuilder.setBody(strFmt(strRem(emailBodyWithHtml, '\r')),true);
                messageBuilder.setSubject("@DGMA_Label:ApprovalMailSubject");
                messageBuilder.addTo(mail);
                messageBuilder.setFrom(fromEmail);
                emailSend = SysMailerFactory::sendNonInteractive(messageBuilder.getMessage());
                emailBodyWithHtml ='';
            }
            info("@DGMA_Label:ApprovalEmailInfo");
           
        }
        catch
        {
            Error("@DGMA_Label:ApproverCatch");
        }
    }